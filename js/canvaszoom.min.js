function CanvasZoom(a,b,c,d){var e=null,f=undefined,g=false,h=true;var i=1;var j=256;var k="jpg";var l="deepzoom";var m=e;var n=h;var o=f;var p=f;var q=f;if(a.getContext===f){m=a.canvas;b=a.tilesFolder;c=a.imageWidth;d=a.imageHeight;n=a.drawBorder===f?h:a.drawBorder;o=a.defaultZoom===f?f:a.defaultZoom;p=a.minZoom===f?f:a.minZoom;q=a.maxZoom===f?f:a.maxZoom;l=a.tilesSystem===f?l:a.tilesSystem;i=a.tileOverlap===f?i:a.tileOverlap;j=a.tileSize===f?j:a.tileSize;k=a.fileType===f?k:a.fileType}else{m=a}var r=g;var s=r===g?r:g;var t=0,u=0,v=-1,w=-1;var x=0,y=0,z=0,A=0,B=0,C=0;var D=g,E=g;var F=0,G=0;var H="w",I="h",J="t",K="wt";var L=e,M=e;var N=e;var O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb;O=function(a,c,d){if(l==="deepzoom"){return b+"/"+a+"/"+c+"_"+d+"."+k}else if(l==="zoomify"){var f=L[a].length*d+c;if(a>0){var g=0,h=e;for(g=a-1;g;g--){h=L[g];f+=h.length*h[0].length}}var i=Math.floor(f/j);return b+"/"+"TileGroup"+i+"/"+a+"-"+c+"-"+d+"."+k}};db=function(){var a=L[w];var b=a.length;var c=a[0].length;var d=0,e=0,f=0;for(d=0;d<b;d++){for(e=0;e<c;e++){a[d][e][J]=M.getImageById(f++)}}L[v][0][0][J]=M.getImageById(f);F=(m.width-a[H])/2;G=(m.height-a[I])/2;var i="mouse";m.addEventListener(i+"move",function(a){Y(P(a))},h);m.addEventListener(i+"down",function(a){_(P(a))},h);m.addEventListener(i+"up",function(a){X(P(a))},h);m.addEventListener(i+"out",function(a){ab(P(a))},h);m.addEventListener(i+"over",function(a){bb(P(a))},h);m.addEventListener("DOMMouseScroll",function(a){cb(P(a))},h);m.addEventListener(i+"wheel",function(a){cb(P(a))},h);window.addEventListener(i+"up",function(a){Z(P(a))},g);window.addEventListener(i+"move",function(a){$(P(a))},g);N=m.getContext("2d");hb()};P=function(a){if(!a){a=window.event}return a};_=function(a){D=h;E=g;z=V(a);A=W(a);B=z;C=A};X=function(a){D=g;E=g;x=V(a);y=W(a);if(x===z&&y===A){T()}};Y=function(a){x=V(a);y=W(a);if(D){var b=F+(x-B);var c=G+(y-C);eb(w,b,c);B=x;C=y;F=b;G=c;hb()}};V=function(a){var b=0;if(a.layerX||a.layerX===0){b=a.layerX-m.offsetLeft}else if(a.offsetX||a.offsetX===0){b=a.offsetX}return b};W=function(a){var b=0;if(a.layerY||a.layerY===0){b=a.layerY-m.offsetTop}else if(a.offsetY||a.offsetY===0){b=a.offsetY}return b};ab=function(a){if(D){E=h}};bb=function(a){E=g};cb=function(a){var b=0;if(a.wheelDelta){b=-(a.wheelDelta/120)}else if(a.detail){b=a.detail/3}if(b){if(b<0){T()}else{U()}}if(a.preventDefault){a.preventDefault()}a.returnValue=g};Z=function(a){if(D&&E){X(a)}};$=function(a){if(D&&E){Y(a)}};R=function(a,b){Q(w+1,a,b);hb()};S=function(a,b){Q(w-1,a,b);hb()};T=function(){R(x,y)};U=function(){S(x,y)};this.zoomInCentre=function(){R(m.width/2,m.height/2)};this.zoomOutCentre=function(){S(m.width/2,m.height/2)};Q=function(a,b,c){if(a>=t&&a<=u){var d=a,e=w,f=b-F,g=c-G;var h=L[d][H]/L[e][H];var i=f*h,j=g*h;var k=F-(i-f),l=G-(j-g);eb(d,k,l);w=d;F=k;G=l}};eb=function(a,b,c){var d=L[a];var f=-b,i=-c;var k=f+m.width,l=i+m.height;var n=0,o=0,p=0,q=0;var r=e;var s=d[H],t=d[I];var u=d.length,v=d[0].length;var w=0,x=0;var y=[];for(w=0;w<u;w++){for(x=0;x<v;x++){r=d[w][x];if(r[J]===e&&r[K]===g){n=w*j;o=n+Math.min(j,s-n);p=x*j;q=p+Math.min(j,t-p);if(!(n>k||o<f||p>l||q<i)){r[K]=h;y.push({name:a+"_"+w+"_"+x,file:O(a,w,x)})}}}}fb(y)};fb=function(a){if(a.length>0){M=new ImageLoader({images:a,onImageLoaded:function(a,b){gb(a,b)}})}};gb=function(a,b){var c=a.split("_");if(c.length===3){var d=L[c[0]][c[1]][c[2]];d[J]=b;d[K]=g;hb()}};hb=function(){var a=m.width,b=m.height,c=L[w];var d=c.length,f=c[0].length,g=-F,h=-G;var k=g+a,l=h+b;var o=0,p=0,q=0,t=0,u=0,z=0,A=0,B=e;var C=c[H],D=c[I];var E=G,K=F,M=G+D,O=F+C;N.clearRect(0,0,a,E+1);N.clearRect(0,E,K+1,b-E);N.clearRect(K+C-1,E,a-K-C+1,b-E);N.clearRect(K,E+D,C,b-E-D);var P=L[v][0][0][J];var Q=0,R=0;for(Q=0;Q<d;Q++){for(R=0;R<f;R++){o=Q*j;p=o+Math.min(j,C-o);q=R*j;t=q+Math.min(j,D-q);if(!(o>k||p<g||q>l||t<h)){B=c[Q][R][J];u=i*Q;z=i*R;o+=F-u;p+=F-u;q+=G-z;t+=G-z;if(B!==e){N.drawImage(B,o,q);if(r){N.strokeRect(o,q,j,j);A++}}else{if(!r||!s){N.save();N.beginPath();N.moveTo(o,q);N.lineTo(p,q);N.lineTo(p,t);N.lineTo(o,t);N.closePath();N.clip();N.drawImage(P,F,G,C,D);N.restore()}else{N.fillStyle="#999";N.fillRect(o,q,p-o,t-q)}}}}}if(n){N.strokeStyle="#000";N.strokeRect(0,0,a,b)}if(r){N.strokeStyle="#ff0";N.strokeRect(g,h,k-g,l-h);N.strokeStyle="#f0f";N.strokeRect(K,E,O-K,M-E);N.fillStyle="#0f0";N.font="normal 12px Arial";N.fillText(x+","+y+" | "+F+","+G+" | "+A,0,20);N.strokeStyle="#f00";var S,T;for(T=0;T<b;T+=j){for(S=0;S<a;S+=j){N.strokeRect(S,T,j,j)}}}};(function(){if(l==="deepzoom"){u=Math.ceil(Math.log(Math.max(c,d))/Math.LN2)}else if(l==="zoomify"){u=Math.ceil(Math.log(Math.max(c,d))/Math.LN2)-Math.log(j)/Math.LN2}L=[];var a=c,b=d;var h=-1;var i=0,k=0,n=0,r=-1,s=-1;for(i=u;i>=t;i--){r=Math.ceil(a/j);s=Math.ceil(b/j);if(v===-1&&a<=j&&b<=j){v=i}if(h===-1&&a<=m.width&&b<=m.height){h=i}L[i]=[];for(k=0;k<r;k++){L[i][k]=[]}L[i][H]=a;L[i][I]=b;for(k=0;k<r;k++){for(n=0;n<s;n++){L[i][k][n]=[];L[i][k][n][J]=e;L[i][k][n][K]=g}}a/=2;b/=2}if(o===f){o=h}w=o;if(p>t){t=p}if(q<u){u=q}if(t>u){var x=t;t=u;u=x}var y=[];var z=0;r=L[w].length;s=L[w][0].length;for(k=0;k<r;k++){for(n=0;n<s;n++){y.push({id:z++,file:O(w,k,n)})}}y.push({id:z,file:O(v,0,0)});M=new ImageLoader({images:y,onAllLoaded:function(){db()}})})()}